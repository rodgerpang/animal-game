<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Animal Rhythm Game</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }

#game {
  display: grid;
  grid-template-columns: repeat(4, 100px);
  grid-gap: 10px;
  justify-content: center;
  margin-top: 20px;
}

.box {
  width: 100px;
  height: 100px;
  border: 2px solid #333;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #eee;
  transition: all 0.2s;
  overflow: hidden;
  box-sizing: border-box;
}

.highlight {
  background-color: yellow;
  border: 4px solid orange;
  box-shadow: 0 0 20px gold;
}

#counter {
  margin-top: 20px;
  font-size: 64px;
  font-weight: bold;
  color: red;
}

button {
  padding: 10px 20px;
  font-size: 18px;
  cursor: pointer;
}

#level {
  margin-top: 10px;
  font-weight: bold;
}

img {
  max-width: 90%;
  max-height: 90%;
  transition: transform 0.2s;
}
  </style>
</head>
<body>
  <h1>Animal Rhythm Game</h1>
  <button id="startBtn">Start</button>
  <div id="level">Level 1</div>

  <div id="game">
    <div class="box" id="box0"></div>
    <div class="box" id="box1"></div>
    <div class="box" id="box2"></div>
    <div class="box" id="box3"></div>
    <div class="box" id="box4"></div>
    <div class="box" id="box5"></div>
    <div class="box" id="box6"></div>
    <div class="box" id="box7"></div>
  </div>
  <div id="counter"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const boxes = Array.from(document.getElementsByClassName('box'));
    const levelDisplay = document.getElementById('level');
    const counterDisplay = document.getElementById('counter');

    let level = 1;

    const animalsByLevel = [
      ['cat.jpg', 'dog.jpg'],           
      ['cat.jpg', 'dog.jpg', 'pig.jpg', 'cow.jpg'],  
      ['cat.jpg', 'dog.jpg', 'pig.jpg', 'cow.jpg', 'bear.jpg', 'rabbit.jpg', 'mouse.jpg']
    ];

    function getAnimalPool(level) {
      if(level <= 2) return animalsByLevel[0];
      if(level <= 5) return animalsByLevel[1];
      return animalsByLevel[2];
    }

    function generateSequence(level){
      const pool = getAnimalPool(level);
      const sequence = [];
      for(let i=0; i<8; i++){
        const randAnimal = pool[Math.floor(Math.random() * pool.length)];
        sequence.push(randAnimal);
      }
      return sequence;
    }

    function displayAnimals(sequence){
      boxes.forEach((box, idx) => {
        const img = document.createElement('img');
        img.src = sequence[idx];
        box.innerHTML = '';
        box.appendChild(img);
      });
    }

    function playSequence(sequence, callback){
      let i = 0;
      function highlightNext() {
        if(i > 0) boxes[i-1].classList.remove('highlight');
        if(i < sequence.length){
          boxes[i].classList.add('highlight');
          i++;
          setTimeout(highlightNext, 400);
        } else {
          boxes[sequence.length-1].classList.remove('highlight');
          if(callback) callback();
        }
      }
      highlightNext();
    }

    // Web Audio API beep
    function playBeep() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();

      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(800, ctx.currentTime);
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);

      oscillator.start();
      oscillator.stop(ctx.currentTime + 0.15); // 150ms beep
    }

    function playBeepCountIn(callback){
      let count = 1;
      function step() {
        if(count <= 8){
          counterDisplay.textContent = count;
          playBeep();  // beep on each count
          count++;
          setTimeout(step, 400);
        } else {
          counterDisplay.textContent = '';
          if(callback) callback();
        }
      }
      step();
    }

    function startLevel() {
      levelDisplay.textContent = `Level ${level}`;
      const sequence = generateSequence(level);
      displayAnimals(sequence);

      playBeepCountIn(() => {
        playSequence(sequence, () => {
          level++;
          if(level > 10) level = 1; // loop back
          setTimeout(startLevel, 1); // 1s pause
        });
      });
    }

    startBtn.addEventListener('click', () => {
      startBtn.disabled = true;
      startLevel();
    });
  </script>
</body>
</html>
